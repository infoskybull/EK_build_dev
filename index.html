<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>Unity Web Player | EK</title>
  <link rel="shortcut icon" href="TemplateData/favicon.ico">
  <link rel="stylesheet" href="TemplateData/style.css">
  <script src="https://telegram.org/js/telegram-web-app.js?56"></script>
  <script src="https://unpkg.com/@tonconnect/ui@2.1.0/dist/tonconnect-ui.min.js"></script>
  <script src="https://sad.adsgram.ai/js/sad.min.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: #000;
    }

    #unity-container {
      position: fixed;
      top: 50%;
      left: 50%;
      width: 360px;
      height: 640px;
      transform: translate(-50%, -50%);
      background: #000;
      z-index: 1;
    }

    #unity-canvas {
      width: 100%;
      height: 100%;
      background: url('Loading.png') no-repeat center;
      background-size: cover;
      z-index: 999;

    }
    #unity-loading-background{
      width: 100%;
      height: 100%;
      background: url('Loading.png') no-repeat center;
      background-size: cover;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-end;
      position: absolute;
      top: 0;
      left: 0;
    }
    #unity-loading-bar {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-end;
      position: absolute;
      bottom: 40px;
      left: 0;
      width: 100%;
      height: 120px; /* Adjust as needed for your loading bar height */
      pointer-events: none;
      z-index: 999;
      background: transparent;
    }

    #unity-progress-bar-empty {
      width: 240px;
      height: 30px;
      margin: 10px auto 0 auto;
      background: url('loading_empty.png') no-repeat center;
      background-size: cover;
      overflow: hidden;
      position: relative;
    }

    #unity-progress-bar-full {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%; /* s·∫Ω b·ªã scale theo chi·ªÅu ngang */
      height: 100%;
      background: url('loading_full.png') no-repeat left center;
      background-size: cover;
      transform: scaleX(0); /* b·∫Øt ƒë·∫ßu t·ª´ 0 */
      transform-origin: left;
      transition: transform 0.2s ease-out;
    }

  </style>

  <style>
    #unity-container input,
    #unity-container textarea {
      font-size: 16px !important;      /* Android ch·ªâ hi·ªÉn th·ªã b√†n ph√≠m n·∫øu >= 16px */
      position: absolute !important;
      top: 50% !important;
      left: 50% !important;
      transform: translate(-50%, -50%) !important;
      width: 160px !important;
      height: 40px !important;
      opacity: 1 !important;           /* Ph·∫£i hi·ªÉn th·ªã ƒë·ªÉ b√†n ph√≠m ho·∫°t ƒë·ªông */
      z-index: 9999 !important;
      background: white !important;
      color: black !important;
    }
  </style>

</head>
<body>
<div id="unity-container">
  <canvas id="unity-canvas"></canvas>

  <div id="unity-loading-background">
    <div id="unity-loading-bar">
      <div id="unity-progress-bar-empty">
        <div id="unity-progress-bar-full"></div>
      </div>

    </div>
  </div>
</div>


<script>
  const canvas   = document.getElementById('unity-container');
  const ASPECT   = 9/16;      // 16:9 (width/height)

  function resizeCanvas(){
    const safeW = window.innerWidth ;
    const safeH = window.innerHeight ;

   
    const currentAspect = safeW / safeH;
    let w,h;
    if(currentAspect > ASPECT){      // c·ª≠a s·ªï qu√° r·ªông
      h = safeH;
      w = h * ASPECT;
    }else{                           // c·ª≠a s·ªï qu√° cao
      w = safeW;
      h = w / ASPECT;
    }
    canvas.style.width  = `${w}px`;
    canvas.style.height = `${h}px`;
  }

  resizeCanvas();
  window.addEventListener('resize', resizeCanvas);
  window.addEventListener('orientationchange', resizeCanvas);
  if(window.visualViewport){
    window.visualViewport.addEventListener('resize', resizeCanvas);
  }
</script>


<script>
  var canvas1 = document.querySelector("#unity-canvas");

  var buildUrl = "Build";
  var loaderUrl = buildUrl + "/EK.loader.js";
  var config = {
    arguments: [],
    dataUrl: buildUrl + "/EK.data.unityweb",
    frameworkUrl: buildUrl + "/EK.framework.js.unityweb",
    codeUrl: buildUrl + "/EK.wasm.unityweb",
    streamingAssetsUrl: "StreamingAssets",
    companyName: "Skybull",
    productName: "EK",
    productVersion: "0.1.0",
  };


  if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
    // Mobile device style: fill the whole browser client area with the game canvas:

    var meta = document.createElement('meta');
    meta.name = 'viewport';
    meta.content = 'width=device-width, height=device-height, initial-scale=1.0, user-scalable=no, shrink-to-fit=yes';
    document.getElementsByTagName('head')[0].appendChild(meta);
    document.querySelector("#unity-container").className = "unity-mobile";
    canvas1.className = "unity-mobile";

  }

  document.querySelector("#unity-loading-bar").style.display = "block";

  const loadingContainer = document.getElementById("unity-loading-background");
  const progressFull = document.getElementById("unity-progress-bar-full");
  const progressEmpty = document.getElementById("unity-progress-bar-empty");
  window.DisableLoading = function() {
    loadingContainer.style.display = "none";
  }

  var script = document.createElement("script");
  var unityInstanceGlobal;
  script.src = loaderUrl;
  script.onload = () => {
    createUnityInstance(canvas1, config, (progress) => {
      progressFull.style.transform = `scaleX(${progress})`;
    }).then((unityInstance) => {
      unityInstanceGlobal = unityInstance;
    }).catch((message) => {
      alert(message);
    });
  };

  document.body.appendChild(script);

</script>
<script>
  window.tonConnect = new TON_CONNECT_UI.TonConnectUI({
    //stagging
    manifestUrl: "https://seahorse-magnetic-officially.ngrok.app/api/ftp/File/get-file/eternal_king_mainnet.json",
    //produce
    //manifestUrl: "https://ftpserver.thedungeondiver.com/api/ftp/File/get-file/eternal_king_mainnet.json",
    testnet: true
  });

  async function testJavaScriptFunction(recipientAddress, amount) {
    console.error("Unity says: " + recipientAddress + "_____" + amount);

    const transaction = {
      validUntil: Math.floor(Date.now() / 1000) + 300, // 5 minutes validity
      messages:
              [
                {
                  address: recipientAddress, // recipient
                  amount: amount, // 50000000 = 0.05 TON in nanoTON
                  payload: undefined, // optional, use .toBoc().toString('base64') if needed
                }
              ]
    };

    try {
      const result = await window.tonConnect.sendTransaction(transaction);
      console.log("‚úÖ Transaction sent!");
      console.log("üì¶ Result:", result);
    }
    catch (err) {
      console.error("‚ùå Transaction rejected or failed:", err);
    }
  }
</script>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    let fixKeyboard = () => {
      const inputs = document.querySelectorAll("input, textarea");
      inputs.forEach(input => {
        // B·∫Øt bu·ªôc input hi·ªÉn th·ªã ƒë√∫ng
        input.style.position = "absolute";
        input.style.opacity = "1";
        input.style.pointerEvents = "auto";
        input.style.zIndex = "10000";
        input.style.fontSize = "16px";
        input.style.width = "80%";
        input.style.height = "40px";
        input.style.top = "50%";
        input.style.left = "50%";
        input.style.transform = "translate(-50%, -50%)";
      });
    };

    // Quan s√°t DOM, khi Unity th√™m input v√†o, ch·ªânh l·∫°i style
    const observer = new MutationObserver(fixKeyboard);
    observer.observe(document.body, { childList: true, subtree: true });
  });
</script>

</body>
</html>
