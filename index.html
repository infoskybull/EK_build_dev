<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>Unity Web Player | EK</title>
  <link rel="shortcut icon" href="TemplateData/favicon.ico">
  <link rel="stylesheet" href="TemplateData/style.css">
  <script src="https://telegram.org/js/telegram-web-app.js?56"></script>
  <script src="https://unpkg.com/@tonconnect/ui@2.1.0/dist/tonconnect-ui.min.js"></script>
  <script src="https://sad.adsgram.ai/js/sad.min.js"></script>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: #000;
    }

    #unity-container {
      position: fixed;
      top: 50%;
      left: 50%;
      width: 360px;
      height: 640px;
      transform: translate(-50%, -50%);
      background: #000;
      z-index: 1;
    }

    #unity-canvas {
      width: 100%;
      height: 100%;
      background: url('Loading.png') no-repeat center;
      background-size: cover;
      z-index: 999;

    }
    #unity-loading-background{
      width: 100%;
      height: 100%;
      background: url('Loading.png') no-repeat center;
      background-size: cover;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-end;
      position: absolute;
      top: 0;
      left: 0;
    }
    #unity-loading-bar {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-end;
      position: absolute;
      bottom: 40px;
      left: 0;
      width: 100%;
      height: 120px; /* Adjust as needed for your loading bar height */
      pointer-events: none;
      z-index: 999;
      background: transparent;
    }

    #unity-progress-bar-empty {
      width: 240px;
      height: 30px;
      margin: 10px auto 0 auto;
      background: url('loading_empty.png') no-repeat center;
      background-size: cover;
      overflow: hidden;
      position: relative;
    }

    #unity-progress-bar-full {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%; /* s·∫Ω b·ªã scale theo chi·ªÅu ngang */
      height: 100%;
      background: url('loading_full.png') no-repeat left center;
      background-size: cover;
      transform: scaleX(0); /* b·∫Øt ƒë·∫ßu t·ª´ 0 */
      transform-origin: left;
      transition: transform 0.2s ease-out;
    }

    /*#unity-container input,*/
    /*#unity-container textarea {*/
    /*  position: absolute !important;*/
    /*  left: -9999px !important;    !* ƒë∆∞a ra kh·ªèi m√†n h√¨nh *!*/
    /*  top: -9999px !important;*/
    /*  width: 1px !important;*/
    /*  height: 1px !important;*/
    /*  font-size: 16px !important;  !* B·∫ÆT BU·ªòC ƒë·ªÉ Android hi·ªán b√†n ph√≠m *!*/
    /*  background: transparent !important;*/
    /*  color: transparent !important;*/
    /*  caret-color: transparent !important;*/
    /*  border: none !important;*/
    /*  outline: none !important;*/
    /*  pointer-events: auto !important;*/
    /*  opacity: 1 !important;*/
    /*  z-index: 0 !important;*/
    /*}*/

  </style>

  <style>
    body{
      margin:0;
      overflow:hidden;
      background:#000;
    }
    #unity-container{
      position:fixed;
      top:50%; left:50%;
      transform:translate(-50%,-50%);
      background:#000;
    }

    /* Bi·∫øn CSS l·∫•y tai th·ªè iOS */
    :root{
      --sa-top:   env(safe-area-inset-top);
      --sa-right: env(safe-area-inset-right);
      --sa-bottom:env(safe-area-inset-bottom);
      --sa-left:  env(safe-area-inset-left);
    }
  </style>


</head>
<body>
<div id="unity-container">
  <canvas id="unity-canvas"></canvas>

  <div id="unity-loading-background">
    <div id="unity-loading-bar">
      <div id="unity-progress-bar-empty">
        <div id="unity-progress-bar-full"></div>
      </div>

    </div>
  </div>
</div>


<script>
  const canvas   = document.getElementById('unity-container');
  const ASPECT   = 9/16;      // 16:9 (width/height)

  function resizeCanvas(){
    //const {top,right,bottom,left} = safeInsets();
    const safeW = window.innerWidth ;
    const safeH = window.innerHeight ;

    // if(isMobile){
    //   /* üì± MOBILE: chi·∫øm to√†n b·ªô v√πng an to√†n, t·ªâ l·ªá t√πy m√°y */
    //   canvas.style.width  = `${safeW}px`;
    //   canvas.style.height = `${safeH}px`;
    // }else{
    /* üíª DESKTOP: √©p t·ªâ l·ªá 16:9, cƒÉn gi·ªØa */
    const currentAspect = safeW / safeH;
    let w,h;
    if(currentAspect > ASPECT){      // c·ª≠a s·ªï qu√° r·ªông
      h = safeH;
      w = h * ASPECT;
    }else{                           // c·ª≠a s·ªï qu√° cao
      w = safeW;
      h = w / ASPECT;
    }
    canvas.style.width  = `${w}px`;
    canvas.style.height = `${h}px`;
    //}
  }

  /* G·ªçi khi t·∫£i & khi ƒë·ªïi k√≠ch th∆∞·ªõc */
  resizeCanvas();
  //window.addEventListener('resize', resizeCanvas);
  window.addEventListener('orientationchange', resizeCanvas);
  if (window.visualViewport) {
    window.visualViewport.addEventListener('resize', () => {
      // Ch√™nh l·ªách gi·ªØa viewport height v√† window height
      const diff = window.innerHeight - window.visualViewport.height;

      // N·∫øu ch√™nh l·ªách > 150px ‚Üí b√†n ph√≠m ƒëang m·ªü ‚Üí kh√¥ng resize
      if (diff > 150) {
        return;
      }

      // Ng∆∞·ª£c l·∫°i ‚Üí resize b√¨nh th∆∞·ªùng
      resizeCanvas();
    });
  }
</script>


<script>
  var canvas1 = document.querySelector("#unity-canvas");

  var buildUrl = "Build";
  var loaderUrl = buildUrl + "/EK.loader.js";
  var config = {
    arguments: [],
    dataUrl: buildUrl + "/EK.data.unityweb",
    frameworkUrl: buildUrl + "/EK.framework.js.unityweb",
    codeUrl: buildUrl + "/EK.wasm.unityweb",
    streamingAssetsUrl: "StreamingAssets",
    companyName: "Skybull",
    productName: "EK",
    productVersion: "0.1.0",
  };


  if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
    // Mobile device style: fill the whole browser client area with the game canvas:

    var meta = document.createElement('meta');
    meta.name = 'viewport';
    meta.content = 'width=device-width, height=device-height, initial-scale=1.0, user-scalable=no, shrink-to-fit=yes';
    document.getElementsByTagName('head')[0].appendChild(meta);
    document.querySelector("#unity-container").className = "unity-mobile";
    canvas1.className = "unity-mobile";

  } else {
    // Desktop style: Render the game canvas in a window that can be maximized to fullscreen:
    //canvas.style.width = "360px";
    //canvas.style.height = "640px";
  }

  document.querySelector("#unity-loading-bar").style.display = "block";

  const loadingContainer = document.getElementById("unity-loading-background");
  const progressFull = document.getElementById("unity-progress-bar-full");
  const progressEmpty = document.getElementById("unity-progress-bar-empty");
  window.DisableLoading = function() {
    loadingContainer.style.display = "none";
  }

  var script = document.createElement("script");
  var unityInstanceGlobal;
  script.src = loaderUrl;
  script.onload = () => {
    createUnityInstance(canvas1, config, (progress) => {
      progressFull.style.transform = `scaleX(${progress})`;
    }).then((unityInstance) => {
      unityInstanceGlobal = unityInstance;
    }).catch((message) => {
      alert(message);
    });
  };

  document.body.appendChild(script);

</script>

<!--<script>-->
<!--  function fixUnityInputForAndroid() {-->
<!--    document.querySelectorAll("input, textarea").forEach(el => {-->
<!--      if (!el.classList.contains("realInput")) {-->
<!--        el.style.position = "absolute";-->
<!--        el.style.left = "-9999px";-->
<!--        el.style.top = "-9999px";-->
<!--        el.style.width = "1px";-->
<!--        el.style.height = "1px";-->
<!--        el.style.fontSize = "16px";-->
<!--        el.style.background = "transparent";-->
<!--        el.style.color = "transparent";-->
<!--        el.style.caretColor = "transparent";-->
<!--        el.style.border = "none";-->
<!--        el.style.outline = "none";-->
<!--        el.style.pointerEvents = "auto";-->
<!--        el.style.opacity = "1";-->
<!--        el.style.zIndex = "0";-->
<!--      }-->
<!--    });-->
<!--  }-->

<!--  const observer = new MutationObserver(fixUnityInputForAndroid);-->
<!--  observer.observe(document.body, { childList: true, subtree: true });-->
<!--  setInterval(fixUnityInputForAndroid, 300); // gi·ªØ ch·∫Øc ch·∫Øn lu√¥n ƒë√∫ng tr√™n Android-->
<!--</script>-->

<script>
  window.tonConnect = new TON_CONNECT_UI.TonConnectUI({
    //stagging
    manifestUrl: "https://seahorse-magnetic-officially.ngrok.app/api/ftp/File/get-file/eternal_king_mainnet.json",
    //produce
    //manifestUrl: "https://ftpserver.thedungeondiver.com/api/ftp/File/get-file/eternal_king_mainnet.json",
    testnet: true
  });

  async function testJavaScriptFunction(recipientAddress, amount) {
    console.error("Unity says: " + recipientAddress + "_____" + amount);

    const transaction = {
      validUntil: Math.floor(Date.now() / 1000) + 300, // 5 minutes validity
      messages:
              [
                {
                  address: recipientAddress, // recipient
                  amount: amount, // 50000000 = 0.05 TON in nanoTON
                  payload: undefined, // optional, use .toBoc().toString('base64') if needed
                }
              ]
    };

    try {
      const result = await window.tonConnect.sendTransaction(transaction);
      console.log("‚úÖ Transaction sent!");
      console.log("üì¶ Result:", result);
    }
    catch (err) {
      console.error("‚ùå Transaction rejected or failed:", err);
    }
  }
</script>



</body>
</html>
