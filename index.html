<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>Unity Web Player | EK</title>
  <link rel="shortcut icon" href="TemplateData/favicon.ico">
  <link rel="stylesheet" href="TemplateData/style.css">
  <script src="https://telegram.org/js/telegram-web-app.js?56"></script>
  <script src="https://unpkg.com/@tonconnect/ui@2.1.0/dist/tonconnect-ui.min.js"></script>
  <script src="https://sad.adsgram.ai/js/sad.min.js"></script>
  <style>
    @media screen and (orientation:landscape) {
      body::before {
        content: "Please rotate your device to portrait mode.";
        display: flex;
        justify-content: center;
        align-items: center;
        position: fixed;
        width: 100vw;
        height: 100vh;
        background: #000;
        color: white;
        font-size: 2em;
        text-align: center;
        z-index: 9999;
      }
      #unity-canvas {
        display: none !important;
      }
    }
  </style>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: #000;
    }

    #unity-container {
      position: fixed;
      top: 50%;
      left: 50%;
      width: 360px;
      height: 640px;
      transform: translate(-50%, -50%);
      background: #000;
      z-index: 1;
    }

    #unity-canvas {
      width: 100%;
      height: 100%;
      background: url('Loading.png') no-repeat center;
      background-size: cover;
      z-index: 999;

    }
    #unity-loading-background{
      width: 100%;
      height: 100%;
      background: url('Loading.png') no-repeat center;
      background-size: cover;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-end;
      position: absolute;
      top: 0;
      left: 0;
    }
    #unity-loading-bar {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-end;
      position: absolute;
      bottom: 40px;
      left: 0;
      width: 100%;
      height: 120px; /* Adjust as needed for your loading bar height */
      pointer-events: none;
      z-index: 999;
      background: transparent;
    }

    #unity-progress-bar-empty {
      width: 60%;
      height: 18px;
      margin-top: 10px;
      background: url('loading_empty.png') no-repeat center;
    }

    #unity-progress-bar-full {
      width: 0%;
      height: 18px;
      background: url('loading_full.png') no-repeat center;
    }
  </style>

  <style>
    body{
      margin:0;
      overflow:hidden;
      background:#000;
    }
    #unity-container{
      position:fixed;
      top:50%; left:50%;
      transform:translate(-50%,-50%);
      background:#000;
    }

    /* Bi·∫øn CSS l·∫•y tai th·ªè iOS */
    :root{
      --sa-top:   env(safe-area-inset-top);
      --sa-right: env(safe-area-inset-right);
      --sa-bottom:env(safe-area-inset-bottom);
      --sa-left:  env(safe-area-inset-left);
    }
  </style>


</head>
<body>
<div id="unity-container" class="unity-desktop">
  <canvas id="unity-canvas" width=360 height=640 tabindex="-1"></canvas>
  <div id="unity-loading-bar">
    <div id="unity-logo"></div>
    <div id="unity-progress-bar-empty">
      <div id="unity-progress-bar-full"></div>
    </div>
  </div>
  <div id="unity-warning"> </div>
  <div id="unity-footer">

  </div>
</div>


<script>
  const canvas   = document.getElementById('unity-container');
  const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
  const ASPECT   = 9/16;      // 16:9 (width/height)

  /* L·∫•y kho·∫£ng tr·ªëng safe-area */
  function safeInsets(){
    const cs = getComputedStyle(document.documentElement);
    const sa = {
      top   : parseFloat(cs.getPropertyValue("--sa-top"))    || 0,
      right : parseFloat(cs.getPropertyValue("--sa-right"))  || 0,
      bottom: parseFloat(cs.getPropertyValue("--sa-bottom")) || 0,
      left  : parseFloat(cs.getPropertyValue("--sa-left"))   || 0
    };
    if(window.visualViewport){
      const vv = window.visualViewport;
      sa.top    = Math.max(sa.top   , vv.offsetTop);
      sa.left   = Math.max(sa.left  , vv.offsetLeft);
      sa.right  = Math.max(sa.right , Math.max(0, window.innerWidth  - vv.width  - vv.offsetLeft));
      sa.bottom = Math.max(sa.bottom, Math.max(0, window.innerHeight - vv.height - vv.offsetTop));
    }
    return sa;
  }

  function resizeCanvas(){
    const {top,right,bottom,left} = safeInsets();
    const safeW = window.innerWidth  - left - right;
    const safeH = window.innerHeight - top  - bottom;

    if(isMobile){
      /* üì± MOBILE: chi·∫øm to√†n b·ªô v√πng an to√†n, t·ªâ l·ªá t√πy m√°y */
      canvas.style.width  = `${safeW}px`;
      canvas.style.height = `${safeH}px`;
    }else{
      /* üíª DESKTOP: √©p t·ªâ l·ªá 16:9, cƒÉn gi·ªØa */
      const currentAspect = safeW / safeH;
      let w,h;
      if(currentAspect > ASPECT){      // c·ª≠a s·ªï qu√° r·ªông
        h = safeH;
        w = h * ASPECT;
      }else{                           // c·ª≠a s·ªï qu√° cao
        w = safeW;
        h = w / ASPECT;
      }
      canvas.style.width  = `${w}px`;
      canvas.style.height = `${h}px`;
    }
  }

  /* G·ªçi khi t·∫£i & khi ƒë·ªïi k√≠ch th∆∞·ªõc */
  resizeCanvas();
  window.addEventListener('resize', resizeCanvas);
  window.addEventListener('orientationchange', resizeCanvas);
  if(window.visualViewport){
    window.visualViewport.addEventListener('resize', resizeCanvas);
  }
</script>


<script>
  var canvas1 = document.querySelector("#unity-canvas");

  var buildUrl = "Build";
  var loaderUrl = buildUrl + "/EK.loader.js";
  var config = {
    arguments: [],
    dataUrl: buildUrl + "/EK.data.unityweb",
    frameworkUrl: buildUrl + "/EK.framework.js.unityweb",
    codeUrl: buildUrl + "/EK.wasm.unityweb",
    streamingAssetsUrl: "StreamingAssets",
    companyName: "Skybull",
    productName: "EK",
    productVersion: "0.1.0",
  };


  // if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
  //   // Mobile device style: fill the whole browser client area with the game canvas:
  //
  //   var meta = document.createElement('meta');
  //   meta.name = 'viewport';
  //   meta.content = 'width=device-width, height=device-height, initial-scale=1.0, user-scalable=no, shrink-to-fit=yes';
  //   document.getElementsByTagName('head')[0].appendChild(meta);
  //   document.querySelector("#unity-container").className = "unity-mobile";
  //   canvas.className = "unity-mobile";
  //
  // } else {
  //   // Desktop style: Render the game canvas in a window that can be maximized to fullscreen:
  //   canvas.style.width = "360px";
  //   canvas.style.height = "640px";
  // }

  document.querySelector("#unity-loading-bar").style.display = "block";

  const loadingContainer = document.getElementById("unity-loading-background");
  const progressFull = document.getElementById("unity-progress-bar-full");
  const progressEmpty = document.getElementById("unity-progress-bar-empty");
  window.DisableLoading = function() {
    loadingContainer.style.display = "none";
  }

  var script = document.createElement("script");
  var unityInstanceGlobal;
  script.src = loaderUrl;
  script.onload = () => {
    createUnityInstance(canvas1, config, (progress) => {
      progressFull.style.width = Math.round(progress * 100) + "%";
    }).then((unityInstance) => {
      document.querySelector("#unity-loading-bar").style.display = "none";
      unityInstanceGlobal = unityInstance;
    }).catch((message) => {
      alert(message);
    });
  };

  document.body.appendChild(script);

</script>
<script>
  window.tonConnect = new TON_CONNECT_UI.TonConnectUI({
    //stagging
    manifestUrl: "https://seahorse-magnetic-officially.ngrok.app/api/ftp/File/get-file/eternal_king_mainnet.json",
    //produce
    //manifestUrl: "https://ftpserver.thedungeondiver.com/api/ftp/File/get-file/eternal_king_mainnet.json",
    testnet: true
  });
 
  async function testJavaScriptFunction(recipientAddress, amount) {
    console.error("Unity says: " + recipientAddress + "_____" + amount);

    const transaction = {
      validUntil: Math.floor(Date.now() / 1000) + 300, // 5 minutes validity
      messages:
              [
                {
                  address: recipientAddress, // recipient
                  amount: amount, // 50000000 = 0.05 TON in nanoTON
                  payload: undefined, // optional, use .toBoc().toString('base64') if needed
                }
              ]
    };

    try {
      const result = await window.tonConnect.sendTransaction(transaction);
      console.log("‚úÖ Transaction sent!");
      console.log("üì¶ Result:", result);
    }
    catch (err) {
      console.error("‚ùå Transaction rejected or failed:", err);
    }
  }
</script>
</body>
</html>
